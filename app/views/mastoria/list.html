
<div class="wrapper">
    <div class="main-body">
        <div class="body-inner">
            <div class="card bg-white">
                <div class="card-content">
                    <div class="row">
                        <!-- MASTORIA TOTAL COUNT AND INFO -->
                        <div layout="row" class="col-sm-3" layout-padding layout-wrap layout-fill>
                            <md-whiteframe class="md-whiteframe-1dp bg-danger" flex-sm="25" flex-gt-sm="25" flex-gt-md="25" layout layout-align="center center">
                                <span ng-if="mastoria.$resolved">{{ mastoria.total }}</span>
                                <span ng-hide="mastoria.$resolved"><md-progress-circular md-mode="indeterminate" class="md-warn md-hue-3 m-auto" md-diameter="20px"></md-progress-circular></span>
                            </md-whiteframe>
                            <span>ΜΑΣΤΟΡΙΑ</span>
                        </div>
                        <!-- SEARCH OVERVIEW -->
                        <div class="col-sm-6">
                            <ol class="breadcrumb bg-danger">
                                <li>
                                    <small>EΙΔΙΚΟΤΗΤΑ:</small>
                                    <span ng-if="params['profession[]']">
                                        <to-string-only-selected values="professions" key="title" selected="params['profession[]']"></to-string-only-selected>
                                    </span>
                                    <span ng-hide="params['profession[]'].length > 0">
                                        ΟΛΕΣ ΟΙ ΕΙΔΙΚΟΤΗΤΕΣ
                                    </span>
                                </li>
                                <li>
                                    <small>ΠΕΡΙΟΧΗ:</small>
                                    <span ng-if="params['area[]']">
                                        <to-string-only-selected values="areas" key="name" selected="params['area[]']"></to-string-only-selected>
                                    </span>
                                    <span ng-hide="params['area[]'].length > 0">
                                        ΟΛΕΣ ΟΙ ΠΕΡΙΟΧΕΣ
                                    </span>
                                </li>
                                <li ng-if="params['q']">
                                    <small>ΛΕΞΗ ΚΛΕΙΔΙ:</small> <span>{{ params['q'] }}</span>
                                </li>
                            </ol>
                        </div>
                        <!-- SEARCH FORM -->
                        <div class="col-sm-3">
                            <div class="input-group">
                              <input type="text" ng-keyup="$event.keyCode == 13 && setParams({q: params.q})" ng-model="params.q" class="form-control" placeholder="Ψάχνω τον/την...">
                              <span class="input-group-btn">
                                <button class="btn btn-danger" ng-click="setParams({q: params.q})" type="button"><span class="glyphicon glyphicon-search"></span></button>
                              </span>
                            </div><!-- /input-group -->
                          </div><!-- /.col-lg-6 -->
                    </div>

                    <div class="row">
                        <!-- PROFESSION AND AREA FILTERS -->
                        <div class="col-sm-3">
                            <!-- Professions -->
                            <div class="panel panel-default panel-labeled">
                                <md-subheader class="md-warn">ΕΙΔΙΚΟΤΗΤΑ</md-subheader>
                                <md-list ng-show="professions.$resolved">
                                    <md-list-item ng-repeat="profession in professions | orderBy:'title'">
                                        <p>{{ ::profession.title }}</p>
                                        <md-checkbox class="md-warn" ng-checked="params['profession[]'].indexOf(profession.id) >= 0" ng-click="toggleItem(profession.id, 'profession[]')"></md-checkbox>
                                    </md-list-item>
                                </md-list>
                            </div>
                            <!-- Areas -->
                            <div class="panel panel-default panel-labeled">
                                <md-subheader class="md-warn">ΠΕΡΙΟΧΕΣ</md-subheader>
                                <div ng-show="!areas.$resolved">
                                    <md-progress-circular md-mode="indeterminate" class="md-warn md-hue-3 m-auto" md-diameter="96"></md-progress-circular>
                                </div>
                                <ui-gmap-google-map id="map"
                                               center="map.center"
                                               pan="map.pan"
                                               zoom="map.zoom"
                                               draggable="true"
                                               refresh="map.refresh"
                                               options="map.options"
                                               events="map.events"
                                               bounds="map.bounds">

                                    <ui-gmap-polygons models="areas" idKey="'id'" path='"geo_json"' fill="map.getPolyFill"
                                                 stroke="{ color: '#2c8aa7', weight: 1, opacity: '1.0' }" visible="true" geodesic="true" fit="false"
                                                 editable="false" static="true" ng-cloak="" events="map.polyEvents">

                                    </ui-gmap-polygons>

                                </ui-gmap-google-map>
                                <md-list ng-show="areas.$resolved">
                                    <md-list-item ng-repeat="area in areas | orderBy:'name'">
                                        <p>{{ ::area.name }}</p>
                                        <md-checkbox class="md-warn" ng-checked="params['area[]'].indexOf(area.id) >= 0" ng-click="toggleItem(area.id, 'area[]')"></md-checkbox>
                                    </md-list-item>
                                </md-list>
                            </div>
                        </div>
                        <!-- RESULTS -->
                        <div class="col-sm-9">
                            <!-- SORTING AND OFFERS/NEAR ME FILTERS -->
                            <div class="panel panel-default">
                                <div class="panel-filters">
                                    <span class="m-l-xs"><strong>ΤΑΞΙΝΟΜΗΣΗ ΑΝΑ</strong></span>
                                    <button class="btn btn-flat" ng-class="{'btn-danger': params.order == 'asc' && params.orderby == 'last_name'}"  ng-click="setParams({orderby: 'last_name', order: 'asc'})">A-Z</button>
                                    <button class="btn btn-flat" ng-class="{'btn-danger': params.order == 'desc' && params.orderby == 'last_name'}"  ng-click="setParams({orderby: 'last_name', order: 'desc'})">Z-A</button>
                                    <button class="btn btn-flat" ng-class="{'btn-danger': params.order == 'desc' && params.orderby == 'avg_rating'}" ng-click="setParams({orderby: 'avg_rating', order: 'desc'})">Αξιολογησεις</button>
                                    <button class="btn btn-flat" ng-class="{'btn-danger': params.order == 'asc' && params.orderby == 'avg_response_time'}" ng-click="setParams({orderby: 'avg_response_time', order: 'asc'})">Χρονος</button>
                                    <md-checkbox class="md-warn m-l-md" ng-false-value="null" ng-true-value="'yes'" ng-model="params.only_offers" ng-change="setParams({only_offers: params.only_offers})">
                                        Προσφορές
                                    </md-checkbox>
                                    <md-checkbox ng-if="near" class="md-warn" ng-false-value="null" ng-true-value="'{{near}}'" ng-model="params.near" ng-change="setParams({near: params.near})">
                                        Κοντά μου
                                    </md-checkbox>
                                </div>
                            </div>

                            <div class="panel panel-default panel-labeled">
                                <div id="mastori-loader-container" ng-hide="mastoria.$resolved"></div>
                                <div class="panel-body" ng-if="mastoria.$resolved">
                                    <!-- NO MASTORIA -->
                                    <div ng-show="mastoria.total === 0">
                                        <span class="text-danger">Πίκρα! Δε βρέθηκε κανένα μαστόρι...</span>
                                    </div>
                                    <!-- LIST OF MASTORIA -->
                                    <div infinite-scroll="loadMore()" infinite-scroll-disabled="busy || mastoria.data.length === mastoria.total" infinite-scroll-distance="1" class="media-list media-divider-full">
                                        <div class="media" ng-repeat="mastori in mastoria.data" ng-class="{'ui-ribbon-container ui-ribbon-danger' : mastori.offers}">
                                            <div class="ui-ribbon-wrapper" ng-if="mastori.offers">
                                                <div class="ui-ribbon">
                                                    <small>ΠΡΟΣΦΟΡΑ</small>
                                                </div>
                                            </div>
                                            <a class="media-left p-b-sm" href="">
                                                <img alt="" src="images/g1.jpg" class="img-circle img64_64">
                                            </a>
                                            <div class="media-body">
                                                <h4 class="media-heading">
                                                    {{ ::mastori.last_name }} {{ ::mastori.first_name }}
                                                    <small ng-if="mastori.paratsoukli" class="text-danger"><i>aka {{ ::mastori.paratsoukli }}</i></small>
                                                </h4>
                                                <div>
                                                    <p class="text-muted">{{ ::mastori.addresses[0].address }}</p>
                                                    <p class="text-muted">T: {{ ::mastori.phone }}</p>

                                                    <uib-rating class="ui-rating size-h4 ui-rating-warning" ng-model="mastori.avg_rating" max="5" data-readonly="true"></uib-rating>

                                                    <p class="m-t-xs">
                                                        ΕΞΥΠΗΡΕΤΕΙ: <to-string values="mastori.areas" key="name"></to-string>
                                                    </p>
                                                </div>
                                                <!-- <p>{{ ::mastori.description }}</p> -->
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-show="busy">
                                        <md-progress-circular md-mode="indeterminate" class="md-warn md-hue-3 m-auto" md-diameter="96"></md-progress-circular>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
